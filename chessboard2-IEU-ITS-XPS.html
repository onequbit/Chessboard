<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="./emojis.css">
    <link rel="stylesheet" type="text/css" href="./chess.css">
    
</head>
<body>    
    <div class="emoji smiley"></div>
    <chess-piece class="white king"></chess-piece>
    <chess-piece class="white queen"></chess-piece>
    <chess-piece class="white bishop"></chess-piece>
    <chess-piece class="white knight"></chess-piece>
    <chess-piece class="white rook"></chess-piece>
    <chess-piece class="black king"></chess-piece>
    <chess-piece class="black queen"></chess-piece>
    <chess-piece class="black bishop"></chess-piece>
    <chess-piece class="black knight"></chess-piece>
    <chess-piece class="black rook"></chess-piece>    
</body>

<script src="TileElement.js"></script>
<script>    
    (function(){
        try
        {
            String.prototype.forEach = function(lambda)
            { 
                this.split(' ').forEach( item => lambda(item) ); 
            }            

            DOMTokenList.prototype.forEach = Array.prototype.forEach;
            HTMLCollection.prototype.forEach = Array.prototype.forEach;            
            HTMLElement.prototype.getElementSize = function(){
                var rect = this.getBoundingClientRect();
                return Math.min(rect.bottom - rect.top, rect.right - rect.left);            
            };
        }
        catch(e) {}
        
    })();

    function getPixelSizeByGridUnits(screen_units)
    {
        var cssSize = Math.round(100/screen_units);
        var sizetest = document.createElement("div");
        sizetest.id = "sizetest";
        sizetest.style = `height:${cssSize}vh;width:${cssSize}vw`;
        document.body.append(sizetest);
        size = sizetest.getElementSize();
        document.getElementById("sizetest").remove();
        return size;
    }

    const CHESS_PIECES = 
    {
        'white' : 
        {
            'king' : "&#9812;",
            'queen' : "&#9813;",
            'rook' : "&#9814;",
            'bishop' : "&#9815;",
            'knight' : "&#9816;",
            'pawn' : "&#9817;"        
        },
        'black' :
        {
            'king' : "&#9818;",
            'queen' : "&#9819;",
            'rook' : "&#9820;",
            'bishop' : "&#9821;",
            'knight' : "&#9822;",
            'pawn' : "&#9823;"        
        }
    };

    class chess_piece extends TileElement
    {
        constructor()
        {
            super();
            if (this.classList.length != 2)
            {
                throw "invalid class list in HTML";
            }            
            this.color = this.classList[0];
            this.rank = this.classList[1];
            // console.log(this.classList);
            // console.log(this.color, this.rank);
            
            if (Object.keys(CHESS_PIECES).indexOf(this.color) < 0)
            {
                throw "invalid chess piece color";
            }
            if (Object.keys(CHESS_PIECES[this.color]).indexOf(this.rank) < 0)
            {
                throw "invalid chess piece name";
            }
            this.layers = {
                back : this.layerAdd("chess-piece-layer back"),
                front : this.layerAdd("chess-piece-layer front")
            }
            this.layers.back.style.color = "white";
            this.layers.back.style.zIndex = -2;
            this.layers.back.innerHTML = CHESS_PIECES['black'][this.rank];
            this.layers.front.style.color = "black";
            this.layers.front.style.shadow = "white";
            this.layers.front.style.zIndex = -1;
            this.layers.front.innerHTML = CHESS_PIECES[this.color][this.rank];            
            return this;
        }         

    }

    

    /*
        const prefix = "&#98";
        const colors = ['WHITE','BLACK'];
        const ranks = ['KING','QUEEN','ROOK','BISHOP','KNIGHT','PAWN'];

        white chess king	♔	U+2654	&#9812;	&#x2654;
        white chess queen	♕	U+2655	&#9813;	&#x2655;
        white chess rook	♖	U+2656	&#9814;	&#x2656;
        white chess bishop	♗	U+2657	&#9815;	&#x2657;
        white chess knight	♘	U+2658	&#9816;	&#x2658;
        white chess pawn	♙	U+2659	&#9817;	&#x2659;

        black chess king	♚	U+265A	&#9818;	&#x265A;
        black chess queen	♛	U+265B	&#9819;	&#x265B;
        black chess rook	♜	U+265C	&#9820;	&#x265C;
        black chess bishop	♝	U+265D	&#9821;	&#x265D;
        black chess knight	♞	U+265E	&#9822;	&#x265E;
        black chess pawn	♟︎	 U+265F	 &#9823; &#x265F;
    */

    customElements.define('chess-piece', chess_piece);

    document.getElementsByTagName("chess-piece").forEach( (item,index) => {        
        if (!item.id) item.id = "chess-piece_" + index;
        item.style.fontSize = "11vh";
    });
    
    var grid_size = document.getElementsByTagName("chess-piece")[0].getElementSize();

    window.onload = function() {
        document.getElementsByTagName('chess-piece').forEach((item, i)=>
        {            
            var left_offset = (i+1) * (grid_size);            
            item.style.left = `${left_offset}px`;
            // console.log(i, grid_size, item);                  
        });        
    };
    
</script>

</html>
